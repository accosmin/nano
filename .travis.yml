sudo: required
dist: trusty
language: cpp

before_script:
  - echo $TRAVIS_OS_NAME
  - |
    if [ "$TRAVIS_OS_NAME" = "osx" ]; then
      brew update
      brew install cmake ninja eigen devil libarchive
      brew link libarchive --force
      export PATH="/usr/local/opt/ccache/libexec:$PATH"
      export CCACHE_CPP2=true
    fi
  - |
    if [ "$TRAVIS_OS_NAME" = "linux" ]; then
      sudo add-apt-repository ppa:nschloe/eigen-backports -y
      sudo add-apt-repository "deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty main" -y
      sudo add-apt-repository "deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-4.0 main" -y
      sudo add-apt-repository "deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-5.0 main" -y
      sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
      wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key | sudo apt-key add -
      sudo apt-get update -qq
      sudo apt-get install -y cmake cmake-data ninja-build libdevil-dev libeigen3-dev libarchive-dev
      export CCACHE_CPP2=true
    fi

matrix:
  include:
    - os: linux
      env:
        - TEST="build g++-4.9"
      script:
        - sudo apt-get install -y g++-4.9
        - export CXX=g++-4.9
        - time bash build.sh --build-type Debug --generator ninja --float --werror
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: linux
      env:
        - TEST="build g++-5"
      script:
        - sudo apt-get install -y g++-5
        - export CXX=g++-5
        - time bash build.sh --build-type Debug --generator ninja --float --werror
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: linux
      env:
        - TEST="build g++-6"
      script:
        - sudo apt-get install -y g++-6
        - export CXX=g++-6
        - time bash build.sh --build-type Debug --generator ninja --float --werror
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: linux
      env:
        - TEST="build g++-7"
      script:
        - sudo apt-get install -y g++-7
        - export CXX=g++-7
        - time bash build.sh --build-type Debug --generator ninja --float --werror
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: linux
      env:
        - TEST="build clang++-3.6"
      script:
        - sudo apt-get install -y clang-3.6 libc++abi-dev libc++-dev
        - export CXX=clang++-3.6
        - time bash build.sh --build-type Debug --generator ninja --float --werror --libc++
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: linux
      env:
        - TEST="build clang++-3.7"
      script:
        - sudo apt-get install -y clang-3.7 libc++abi-dev libc++-dev
        - export CXX=clang++-3.7
        - time bash build.sh --build-type Debug --generator ninja --float --werror --libc++
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: linux
      env:
        - TEST="build clang++-3.8"
      script:
        - sudo apt-get install -y clang-3.8 libc++abi-dev libc++-dev
        - export CXX=clang++-3.8
        - time bash build.sh --build-type Debug --generator ninja --float --werror --libc++
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: linux
      env:
        - TEST="build clang++-3.9"
      script:
        - sudo apt-get install -y clang-3.9 libc++abi-dev libc++-dev
        - export CXX=clang++-3.9
        - time bash build.sh --build-type Debug --generator ninja --float --werror --libc++
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: linux
      env:
        - TEST="build clang++-4.0"
      script:
        - sudo apt-get install -y clang-4.0 libc++abi-dev libc++-dev
        - export CXX=clang++-4.0
        - time bash build.sh --build-type Debug --generator ninja --float --werror --libc++
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: linux
      env:
        - TEST="build clang++-5.0"
      script:
        - sudo apt-get install -y clang-5.0 libc++abi-dev libc++-dev
        - export CXX=clang++-5.0
        - time bash build.sh --build-type Debug --generator ninja --float --werror --libc++
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: osx
      env:
        - TEST="build xcode7.3"
      script:
        - time bash build.sh --build-type Debug --generator ninja --float --werror
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

    - os: osx
      env:
        - TEST="build xcode8"
      script:
        - time bash build.sh --build-type Debug --generator ninja --float --werror
        - ./build-debug/apps/info --system
        - cd build-debug/test && time ctest -j 2 -E "test_task_*"

